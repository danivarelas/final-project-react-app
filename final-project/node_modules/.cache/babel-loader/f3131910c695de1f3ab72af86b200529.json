{"ast":null,"code":"var _jsxFileName = \"/Users/user/Desktop/final-project-react-app/final-project/src/pages/NewTransfer/NewTransfer.js\";\nimport React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport validate from '../../utils/JWTParser';\nimport Navbar from '../../components/Navbar/Navbar';\nimport Axios from 'axios';\nimport './NewTransfer.scss';\nimport { format } from 'date-fns';\nimport LabelGroup from '../../components/LabelGroup/LabelGroup';\n\nconst NewTransfer = () => {\n  const history = useHistory();\n  const [description, setDescription] = useState(\"\");\n  const [amount, setAmount] = useState(\"\");\n  const [sourceAccountNumber, setSourceAccountNumber] = useState(\"\");\n  const [targetAccountNumber, setTargetAccountNumber] = useState(\"\");\n  const [exchangeRates, setExchangeRates] = useState({});\n  const [accounts, setAccounts] = useState([]);\n  const [invalidAmount, setInvalidAmount] = useState(false);\n  const [insufficientFunds, setInsufficientFunds] = useState(false);\n  const [sameAccountt, setSameAccount] = useState(false);\n  const [invalidAccount, setInvalidAccount] = useState(false);\n  const [inputDisabled, setInputDisabled] = useState(false);\n  const [submitDisabled, setSubmitDisabled] = useState(true);\n\n  if (!validate(sessionStorage.getItem('JWT'))) {\n    history.push(\"/login\");\n  }\n\n  useEffect(() => {\n    if (description && amount && targetAccountNumber) {\n      setSubmitDisabled(false);\n    } else {\n      setSubmitDisabled(true);\n    }\n\n    const token = sessionStorage.getItem('JWT');\n    const claims = validate(token);\n\n    if (claims) {\n      Axios.get(`http://localhost:8081/api/v1/account/byUserId/${claims.id}`, {\n        headers: {\n          JWT: token\n        }\n      }).then(res => {\n        const {\n          data\n        } = res;\n        setAccounts(data);\n        setSourceAccountNumber(data[0].accountNumber);\n      }).catch(e => {});\n      let dateToday = new Date();\n      dateToday = format(dateToday, \"dd/MM/yyyy\");\n      Axios.get(`https://tipodecambio.paginasweb.cr/api/${dateToday}`).then(res => {\n        const {\n          data\n        } = res;\n        setExchangeRates(data);\n      });\n    }\n  }, [inputDisabled, submitDisabled, description, amount, targetAccountNumber]);\n\n  const handleSubmit = async e => {\n    const token = sessionStorage.getItem('JWT');\n    e.preventDefault();\n\n    if (sourceAccountNumber !== targetAccountNumber) {\n      setSameAccount(false);\n      setInsufficientFunds(false);\n      const validAmount = checkAmount();\n      const validAccount = await checkAccount(targetAccountNumber);\n\n      if (!validAmount || !validAccount) {\n        validAmount ? setInvalidAmount(false) : setInvalidAmount(true);\n        validAccount ? setInvalidAccount(false) : setInvalidAccount(true);\n      } else {\n        const sourceAccount = await checkAccount(sourceAccountNumber);\n        const targetAccount = await checkAccount(targetAccountNumber);\n        const transfer = {\n          transferNumber: Math.floor(Math.random() * 100000000 + 1000000000),\n          transferDescription: description,\n          amount: amount,\n          transferDate: new Date(),\n          sourceAccountId: sourceAccount.id,\n          targetAccountId: targetAccount.id\n        };\n        const {\n          compra,\n          venta\n        } = exchangeRates;\n        Axios.post(`http://localhost:8081/api/v1/transfer?buy=${compra}&sell=${venta}`, transfer, {\n          headers: {\n            JWT: token\n          }\n        }).then(res => {\n          history.goBack();\n        }).catch(e => {\n          console.log(e);\n          setInsufficientFunds(true);\n        });\n      }\n    } else {\n      setInvalidAccount(false);\n      setSameAccount(true);\n    }\n  };\n\n  const checkAmount = () => {\n    if (amount > 0) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  const checkAccount = async number => {\n    let res = await Axios.get(`http://localhost:8081/api/v1/account/${number}`, {\n      headers: {\n        JWT: sessionStorage.getItem('JWT')\n      }\n    });\n    return res.data.accountNumber ? res.data : null;\n  };\n\n  const handleCancel = () => {\n    history.goBack();\n  };\n\n  const handleSourceAccount = event => {\n    let {\n      value\n    } = event.target;\n    setSourceAccountNumber(value);\n  };\n\n  const handleDescription = event => {\n    let {\n      value\n    } = event.target;\n    setDescription(value);\n  };\n\n  const handleAmount = event => {\n    let {\n      value\n    } = event.target;\n    setAmount(value);\n  };\n\n  const handleTargetAccount = event => {\n    let {\n      value\n    } = event.target;\n    setTargetAccountNumber(value);\n  };\n\n  const toggleDisabled = event => {\n    setInputDisabled(!inputDisabled);\n    setInvalidAccount(false);\n    setSameAccount(false);\n    setInvalidAmount(false);\n    setInsufficientFunds(false);\n  };\n\n  return React.createElement(\"div\", {\n    className: \"wrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    id: \"content\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, React.createElement(Navbar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    className: \"page-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, \"New Transfer\"))), React.createElement(\"div\", {\n    className: \"block-section container-fluid\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"block-section-header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    className: \"block-section-header-text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, \"Transfer Details\")), React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, \"Source Account\"), React.createElement(\"select\", {\n    disabled: inputDisabled,\n    className: \"form-control\",\n    id: \"source-account\",\n    onChange: handleSourceAccount,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, accounts.map((account, index) => {\n    if (index === 0) {\n      return React.createElement(\"option\", {\n        key: account.id,\n        value: account.accountNumber,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, account.accountNumber + \" - \" + account.balance + \" \" + account.currency);\n    } else {\n      return React.createElement(\"option\", {\n        key: account.id,\n        value: account.accountNumber,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, account.accountNumber + \" - \" + account.balance + \" \" + account.currency);\n    }\n  }))), React.createElement(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, \"Description\"), React.createElement(\"input\", {\n    disabled: inputDisabled,\n    className: \"form-control\",\n    type: \"text\",\n    required: true,\n    onChange: handleDescription,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183\n    },\n    __self: this\n  }, \"Amount\"), React.createElement(\"input\", {\n    disabled: inputDisabled,\n    className: \"form-control\",\n    type: \"number\",\n    required: true,\n    step: \"0.01\",\n    onChange: handleAmount,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }), React.createElement(\"small\", {\n    id: \"passwordHelpBlock\",\n    className: \"form-text text-muted\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, \"The amount has to be specified in the source account currency.\"), invalidAmount && React.createElement(\"div\", {\n    className: \"invalid-entry\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, \"You have to specify an amount greater than zero.\"), insufficientFunds && React.createElement(\"div\", {\n    className: \"invalid-entry\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, \"You have insufficient funds.\")), React.createElement(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, \"Target Account\"), React.createElement(\"input\", {\n    disabled: inputDisabled,\n    className: \"form-control\",\n    type: \"text\",\n    required: true,\n    onChange: handleTargetAccount,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }), invalidAccount && React.createElement(\"div\", {\n    className: \"invalid-entry\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199\n    },\n    __self: this\n  }, \"This account doesn't exist.\"), sameAccountt && React.createElement(\"div\", {\n    className: \"invalid-entry\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }, \"You can't transfer funds to the same account.\")), !inputDisabled && React.createElement(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"cancel\",\n    className: \"btn btn-danger\",\n    onClick: handleCancel,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }, \"Cancel\"), React.createElement(\"button\", {\n    disabled: submitDisabled,\n    type: \"button\",\n    className: \"btn btn-success\",\n    \"data-toggle\": \"collapse\",\n    \"data-target\": \"#collapseExample\",\n    \"aria-expanded\": \"false\",\n    \"aria-controls\": \"collapseExample\",\n    onClick: toggleDisabled,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }, \"Continue\")), React.createElement(\"div\", {\n    class: \"collapse\",\n    id: \"collapseExample\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    class: \"card card-body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212\n    },\n    __self: this\n  }, React.createElement(LabelGroup, {\n    title: \"Source Account\",\n    text: sourceAccountNumber,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213\n    },\n    __self: this\n  }), React.createElement(LabelGroup, {\n    title: \"Description\",\n    text: description,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }), React.createElement(LabelGroup, {\n    title: \"Amount\",\n    text: amount,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215\n    },\n    __self: this\n  }), React.createElement(LabelGroup, {\n    title: \"Target Account\",\n    text: targetAccountNumber,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    onClick: toggleDisabled,\n    type: \"button\",\n    className: \"btn btn-danger\",\n    \"data-toggle\": \"collapse\",\n    \"data-target\": \"#collapseExample\",\n    \"aria-expanded\": \"false\",\n    \"aria-controls\": \"collapseExample\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217\n    },\n    __self: this\n  }, \"Back\"), React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-success\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, \"Transfer\")))))));\n};\n\nexport default NewTransfer;","map":{"version":3,"sources":["/Users/user/Desktop/final-project-react-app/final-project/src/pages/NewTransfer/NewTransfer.js"],"names":["React","useState","useEffect","useHistory","validate","Navbar","Axios","format","LabelGroup","NewTransfer","history","description","setDescription","amount","setAmount","sourceAccountNumber","setSourceAccountNumber","targetAccountNumber","setTargetAccountNumber","exchangeRates","setExchangeRates","accounts","setAccounts","invalidAmount","setInvalidAmount","insufficientFunds","setInsufficientFunds","sameAccountt","setSameAccount","invalidAccount","setInvalidAccount","inputDisabled","setInputDisabled","submitDisabled","setSubmitDisabled","sessionStorage","getItem","push","token","claims","get","id","headers","JWT","then","res","data","accountNumber","catch","e","dateToday","Date","handleSubmit","preventDefault","validAmount","checkAmount","validAccount","checkAccount","sourceAccount","targetAccount","transfer","transferNumber","Math","floor","random","transferDescription","transferDate","sourceAccountId","targetAccountId","compra","venta","post","goBack","console","log","number","handleCancel","handleSourceAccount","event","value","target","handleDescription","handleAmount","handleTargetAccount","toggleDisabled","map","account","index","balance","currency"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport validate from '../../utils/JWTParser';\nimport Navbar from '../../components/Navbar/Navbar';\nimport Axios from 'axios';\nimport './NewTransfer.scss';\nimport { format } from 'date-fns';\nimport LabelGroup from '../../components/LabelGroup/LabelGroup';\n\nconst NewTransfer = () => {\n\n    const history = useHistory();\n\n    const [description, setDescription] = useState(\"\");\n    const [amount, setAmount] = useState(\"\");\n    const [sourceAccountNumber, setSourceAccountNumber] = useState(\"\");\n    const [targetAccountNumber, setTargetAccountNumber] = useState(\"\");\n    const [exchangeRates, setExchangeRates] = useState({});\n\n    const [accounts, setAccounts] = useState([]);\n    const [invalidAmount, setInvalidAmount] = useState(false);\n    const [insufficientFunds, setInsufficientFunds] = useState(false);\n    const [sameAccountt, setSameAccount] = useState(false);\n    const [invalidAccount, setInvalidAccount] = useState(false);\n    const [inputDisabled, setInputDisabled] = useState(false);\n    const [submitDisabled, setSubmitDisabled] = useState(true);\n\n    if (!validate(sessionStorage.getItem('JWT'))) {\n        history.push(\"/login\");\n    }\n\n    useEffect(() => {\n        if (description && amount && targetAccountNumber) {\n            setSubmitDisabled(false);\n        } else {\n            setSubmitDisabled(true);\n        }\n        const token = sessionStorage.getItem('JWT');\n        const claims = validate(token);\n        if (claims) {\n            Axios.get(`http://localhost:8081/api/v1/account/byUserId/${claims.id}`, {\n                headers: { JWT: token }\n            }).then(res => {\n                const { data } = res;\n                setAccounts(data);\n                setSourceAccountNumber(data[0].accountNumber);\n            }).catch(e => {\n\n            });\n            let dateToday = new Date();\n            dateToday = format(dateToday, \"dd/MM/yyyy\");\n            Axios.get(`https://tipodecambio.paginasweb.cr/api/${dateToday}`)\n                .then(res => {\n                    const { data } = res;\n                    setExchangeRates(data);\n                });\n        }\n    }, [inputDisabled, submitDisabled, description, amount, targetAccountNumber]);\n\n    const handleSubmit = async (e) => {\n        const token = sessionStorage.getItem('JWT');\n        e.preventDefault();\n        if (sourceAccountNumber !== targetAccountNumber) {\n            setSameAccount(false);\n            setInsufficientFunds(false);\n\n            const validAmount = checkAmount();\n            const validAccount = await checkAccount(targetAccountNumber);\n\n            if (!validAmount || !validAccount) {\n                validAmount ? setInvalidAmount(false) : setInvalidAmount(true);\n                validAccount ? setInvalidAccount(false) : setInvalidAccount(true);\n            } else {\n                const sourceAccount = await checkAccount(sourceAccountNumber);\n                const targetAccount = await checkAccount(targetAccountNumber);\n\n                const transfer = {\n                    transferNumber: Math.floor((Math.random() * 100000000) + 1000000000),\n                    transferDescription: description,\n                    amount: amount,\n                    transferDate: new Date(),\n                    sourceAccountId: sourceAccount.id,\n                    targetAccountId: targetAccount.id\n                }\n\n                const { compra, venta } = exchangeRates;\n\n                Axios.post(`http://localhost:8081/api/v1/transfer?buy=${compra}&sell=${venta}`, transfer, {\n                    headers: { JWT: token }\n                }).then(res => {\n                    history.goBack();\n                }).catch(e => {\n                    console.log(e);\n                    setInsufficientFunds(true);\n                });\n            }\n        } else {\n            setInvalidAccount(false);\n            setSameAccount(true);\n        }\n    }\n\n    const checkAmount = () => {\n        if (amount > 0) {\n            return true;\n        } else {\n            return false;\n        }\n    };\n\n    const checkAccount = async (number) => {\n        let res = await Axios.get(`http://localhost:8081/api/v1/account/${number}`, {\n            headers: { JWT: sessionStorage.getItem('JWT') }\n        })\n        return res.data.accountNumber ? res.data : null;\n    };\n\n    const handleCancel = () => { history.goBack(); }\n\n    const handleSourceAccount = event => {\n        let {value} = event.target;\n        setSourceAccountNumber(value);\n    };\n\n    const handleDescription = event => {\n        let {value} = event.target;\n        setDescription(value);\n    };\n\n    const handleAmount = event => {\n        let {value} = event.target;\n        setAmount(value);\n    };\n\n    const handleTargetAccount = event => {\n        let {value} = event.target;\n        setTargetAccountNumber(value);\n    };\n\n    const toggleDisabled = event => {\n        setInputDisabled(!inputDisabled);\n        setInvalidAccount(false);\n        setSameAccount(false);\n        setInvalidAmount(false);\n        setInsufficientFunds(false);\n    };\n\n    return (\n        <div className=\"wrapper\">\n            <div id=\"content\">\n                <Navbar />\n                <div className=\"container-fluid\">\n                    <div className=\"row\">\n                        <h2 className=\"page-title\">New Transfer</h2>\n                    </div>\n                </div>\n                <div className=\"block-section container-fluid\">\n                    <div className=\"block-section-header\">\n                        <h3 className=\"block-section-header-text\">Transfer Details</h3>\n                    </div>\n                    <form onSubmit={handleSubmit}>\n                        <div className=\"form-group\">\n                            <label>Source Account</label>\n                            <select disabled={inputDisabled} className=\"form-control\" id=\"source-account\" onChange={handleSourceAccount}>\n                                {accounts.map((account, index) => {\n                                    if (index === 0) {\n                                        return <option key={account.id} value={account.accountNumber} >\n                                            {account.accountNumber + \" - \" + account.balance + \" \" + account.currency}\n                                        </option>;\n                                    } else {\n                                        return <option key={account.id} value={account.accountNumber}>\n                                            {account.accountNumber + \" - \" + account.balance + \" \" + account.currency}\n                                        </option>;\n                                    }\n                                })}\n                            </select>\n                        </div>\n                        <div className=\"form-group\">\n                            <label>Description</label>\n                            <input disabled={inputDisabled} className=\"form-control\" type=\"text\" required onChange={handleDescription} />\n                        </div>\n                        <div className=\"form-group\">\n                            <label>Amount</label>\n                            <input disabled={inputDisabled} className=\"form-control\" type=\"number\" required step=\"0.01\" onChange={handleAmount} />\n                            <small id=\"passwordHelpBlock\" className=\"form-text text-muted\">\n                                The amount has to be specified in the source account currency.\n                            </small>\n                            {invalidAmount &&\n                                <div className=\"invalid-entry\">You have to specify an amount greater than zero.</div>\n                            }\n                            {insufficientFunds &&\n                                <div className=\"invalid-entry\">You have insufficient funds.</div>\n                            }\n                        </div>\n                        <div className=\"form-group\">\n                            <label>Target Account</label>\n                            <input disabled={inputDisabled} className=\"form-control\" type=\"text\" required onChange={handleTargetAccount} />\n                            {invalidAccount &&\n                                <div className=\"invalid-entry\">This account doesn't exist.</div>\n                            }\n                            {sameAccountt &&\n                                <div className=\"invalid-entry\">You can't transfer funds to the same account.</div>\n                            }\n                        </div>\n                        {!inputDisabled &&\n                            <div className=\"form-group\">\n                            <button type=\"cancel\" className=\"btn btn-danger\" onClick={handleCancel}>Cancel</button>\n                            <button disabled={submitDisabled} type=\"button\" className=\"btn btn-success\" data-toggle=\"collapse\" data-target=\"#collapseExample\" aria-expanded=\"false\" aria-controls=\"collapseExample\" onClick={toggleDisabled}>Continue</button>\n                        </div>\n                        }\n                        <div class=\"collapse\" id=\"collapseExample\">\n                            <div class=\"card card-body\">\n                                <LabelGroup title=\"Source Account\" text={sourceAccountNumber}/>\n                                <LabelGroup title=\"Description\" text={description}/>\n                                <LabelGroup title=\"Amount\" text={amount}/>\n                                <LabelGroup title=\"Target Account\" text={targetAccountNumber}/>\n                                <button onClick={toggleDisabled} type=\"button\" className=\"btn btn-danger\" data-toggle=\"collapse\" data-target=\"#collapseExample\" aria-expanded=\"false\" aria-controls=\"collapseExample\">Back</button>\n                                <button type=\"submit\" className=\"btn btn-success\">Transfer</button>\n                            </div>\n                            \n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default NewTransfer;"]},"metadata":{},"sourceType":"module"}